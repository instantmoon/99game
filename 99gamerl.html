<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±ªæ±ªéšŠæ•¸å­¸æ•‘æ´ä»»å‹™</title>
    <style>
        :root {
            --paw-blue: #007BFF;
            --paw-red: #DC3545;
            --paw-yellow: #FFC107;
            --bg-dark: #2c3e50;
            --text-light: #ecf0f1;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #game-area {
            background: linear-gradient(145deg, #34495e, #2c3e50);
            border: 8px solid var(--paw-yellow);
            border-radius: 25px;
            padding: 25px;
            width: 550px;
            text-align: center;
            box-shadow: 0 0 40px rgba(255, 193, 7, 0.4);
            position: relative;
            box-sizing: border-box; /* ç¢ºä¿paddingä¸æœƒæ’å¤§ */
        }

        h1 {
            color: var(--paw-yellow);
            text-shadow: 3px 3px 0px var(--paw-blue);
            font-size: 2.8rem;
            margin-top: 10px;
        }

        .status-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: var(--paw-red);
            padding: 8px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 0px #000;
        }

        .status-item span {
            margin-left: 8px;
        }

        #map-display {
            font-size: 3rem;
            margin: 20px 0;
            min-height: 80px;
        }

        #event-message {
            font-size: 1.3rem;
            margin-bottom: 20px;
            min-height: 60px;
            line-height: 1.5;
        }

        #question-display {
            font-size: 3.5rem;
            font-weight: bold;
            color: var(--paw-yellow);
            text-shadow: 2px 2px 0px var(--paw-blue);
            margin: 20px 0;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            background-color: var(--paw-blue);
            color: white;
            border: 4px solid var(--paw-yellow);
            border-radius: 12px;
            padding: 15px;
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }

        button:hover {
            transform: translateY(-3px);
            background-color: #0056b3;
        }

        button:active {
            transform: translateY(0);
        }

        #direction-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .direction-button {
            background-color: var(--paw-red);
            font-size: 1.5rem;
            padding: 12px;
            border: 3px solid var(--paw-yellow);
        }
        .direction-button:hover {
            background-color: #c82333;
        }

        #game-over-screen {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            border-radius: 20px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        #game-over-screen button {
            background-color: var(--paw-yellow);
            color: var(--bg-dark);
            margin-top: 20px;
            font-size: 1.8rem;
            border: none;
        }
        #game-over-screen button:hover {
            background-color: #e0a800;
        }

        /* éš±è—å…ƒç´  */
        .hidden { display: none; }
        .visible { display: block; }
        .flex-visible { display: flex; }
    </style>
</head>
<body>

<div id="game-area">
    <h1>æ±ªæ±ªéšŠæ•‘æ´ä»»å‹™ï¼</h1>

    <div class="status-bar">
        <div class="status-item">ğŸ¦´ <span id="hp">3</span></div>
        <div class="status-item">ğŸ—ºï¸ <span id="level">1</span></div>
        <div class="status-item">â­ <span id="score">0</span></div>
    </div>

    <div id="map-display">ğŸ¶</div>
    <div id="event-message">ã€ŒèŠå¾·éšŠé•·é‡åˆ°éº»ç…©äº†ï¼æ±ªæ±ªéšŠï¼Œæº–å‚™å‡ºå‹•ï¼ã€</div>

    <div id="math-challenge" class="hidden">
        <div id="question-display">? Ã— ?</div>
        <div class="options-grid" id="options"></div>
    </div>

    <div id="movement-controls" class="visible">
        <div id="direction-buttons">
            <button class="direction-button" onclick="move('left')">â¬…ï¸ å‰é€²</button>
            <button class="direction-button" onclick="move('forward')">â¬†ï¸ æ¢ç´¢</button>
            <button class="direction-button" onclick="move('right')">â¡ï¸ æ•‘æ´</button>
        </div>
    </div>

    <div id="game-over-screen">
        <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ˜­</div>
        <h2>ä»»å‹™å¤±æ•—ï¼</h2>
        <p>èŠå¾·éšŠé•·é‚„åœ¨ç­‰å¾…ä½ çš„æ•‘æ´ï¼</p>
        <p>ä½ æ‹¯æ•‘äº† <span id="final-score">0</span> ä½å°å‹•ç‰©ã€‚</p>
        <button onclick="startGame()">å†æ¬¡å‡ºå‹•ï¼</button>
    </div>

</div>

<script>
    const pawEmojis = {
        start: "ğŸ¶", rescue: "ğŸ¾", obstacle: "ğŸš§", math: "ğŸ’¡", bonus: "ğŸ¦´", trap: "âš¡",
        forest: "ğŸŒ³", town: "ğŸ˜ï¸", snow: "ğŸŒ¨ï¸", water: "ğŸŒŠ"
    };
    const pawMembers = ["ğŸ¶ é˜¿å¥‡", "ğŸš’ æ¯›æ¯›", "ğŸš å¤©å¤©", "ğŸšœ å°ç¤«", "â™»ï¸ ç°ç°", "ğŸ’§ è·¯é¦¬"];

    let currentHP = 3;
    let currentLevel = 1;
    let currentScore = 0; // æˆåŠŸæ•‘æ´æ¬¡æ•¸
    let currentCorrectAnswer = 0;

    const dialogueMessages = {
        start: "æ±ªæ±ªéšŠé›†åˆï¼èŠå¾·éšŠé•·éœ€è¦æˆ‘å€‘ï¼",
        move: (direction) => `ä½ é¸æ“‡å‘${direction}å‰é€²ï¼`,
        mathQuestion: (member) => `${member} ç™¼å‡ºæ±‚æ•‘è¨Šè™Ÿï¼ä½ éœ€è¦è§£æ±ºæ•¸å­¸é¡Œæ‰èƒ½å¹«ä»–ï¼`,
        correct: "å¤ªæ£’äº†ï¼æˆåŠŸæ•‘æ´ï¼+1 ğŸ¦´",
        incorrect: "å–”ä¸ï¼ç‹—ç‹—åŠ›é‡æ¸›å¼±äº†ï¼-1 ğŸ¦´",
        foundBone: "ç™¼ç¾è£œçµ¦å“ï¼+1 ğŸ¦´",
        hitTrap: "è¸©åˆ°é™·é˜±äº†ï¼-1 ğŸ¦´",
        levelUp: (level) => `ä½ æŠµé”äº†ç¬¬ ${level} å€‹å€åŸŸï¼`,
        gameOver: "ä»»å‹™å¤±æ•—ï¼Œæˆ‘å€‘ä¸‹æ¬¡æœƒæ›´åŠªåŠ›çš„ï¼"
    };

    const mathChallengeDiv = document.getElementById('math-challenge');
    const movementControlsDiv = document.getElementById('movement-controls');
    const gameOverScreen = document.getElementById('game-over-screen');

    function updateStatus() {
        document.getElementById('hp').innerText = currentHP;
        document.getElementById('level').innerText = currentLevel;
        document.getElementById('score').innerText = currentScore;
        document.getElementById('map-display').innerText = pawEmojis.rescue.repeat(currentScore); // ç”¨æ•‘æ´æ•¸é¡¯ç¤ºé€²åº¦
        if (currentHP <= 0) {
            endGame();
        }
    }

    function setDialogue(message) {
        document.getElementById('event-message').innerText = message;
    }

    function generateMathQuestion() {
        const num1 = Math.floor(Math.random() * 9) + 1; // 1åˆ°9
        const num2 = Math.floor(Math.random() * 9) + 1; // 1åˆ°9
        currentCorrectAnswer = num1 * num2;

        document.getElementById('question-display').innerText = `${num1} Ã— ${num2} = ?`;

        let options = [currentCorrectAnswer];
        while (options.length < 4) {
            let wrong = (Math.floor(Math.random() * 9) + 1) * (Math.floor(Math.random() * 9) + 1);
            // ç¢ºä¿éŒ¯èª¤é¸é …ä¸é‡è¤‡ä¸”ä¸ç­‰æ–¼æ­£ç¢ºç­”æ¡ˆï¼Œä¸”ä¸è¦ç”¢ç”Ÿè² æ•¸
            if (!options.includes(wrong) && wrong > 0) options.push(wrong);
        }
        options.sort(() => Math.random() - 0.5); // æ´—ç‰Œ

        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt);
            optionsDiv.appendChild(btn);
        });

        mathChallengeDiv.classList.remove('hidden');
        movementControlsDiv.classList.add('hidden');
    }

    function checkAnswer(selectedAnswer) {
        if (selectedAnswer === currentCorrectAnswer) {
            currentHP = Math.min(currentHP + 1, 5); // æœ€å¤š5é»HP
            currentScore++;
            setDialogue(dialogueMessages.correct);
        } else {
            currentHP--;
            setDialogue(dialogueMessages.incorrect);
        }
        updateStatus();
        
        mathChallengeDiv.classList.add('hidden');
        movementControlsDiv.classList.remove('hidden');
        if (currentHP > 0) { // å¦‚æœHPé‚„æœ‰ï¼Œæ‰é€²å…¥ä¸‹ä¸€å€‹äº‹ä»¶
            setTimeout(nextEvent, 1500);
        }
    }

    function move(direction) {
        setDialogue(dialogueMessages.move(direction === 'left' ? 'å·¦é‚Š' : (direction === 'right' ? 'å³é‚Š' : 'å‰æ–¹')));
        currentLevel++;
        setDialogue(dialogueMessages.levelUp(currentLevel));
        updateStatus();
        setTimeout(nextEvent, 1000); // é¸æ“‡å¾Œé¦¬ä¸Šè§¸ç™¼äº‹ä»¶
    }

    function nextEvent() {
        if (currentHP <= 0) {
            endGame();
            return;
        }

        const eventType = Math.random();
        if (eventType < 0.5) { // æ•¸å­¸æŒ‘æˆ°
            const randomMember = pawMembers[Math.floor(Math.random() * pawMembers.length)];
            setDialogue(dialogueMessages.mathQuestion(randomMember));
            generateMathQuestion();
        } else if (eventType < 0.75) { // ç™¼ç¾éª¨é ­
            currentHP = Math.min(currentHP + 1, 5);
            setDialogue(dialogueMessages.foundBone);
            updateStatus();
            // è‡ªå‹•å›åˆ°ç§»å‹•æ§åˆ¶ï¼Œå› ç‚ºæ²’æœ‰äº’å‹•
            setTimeout(() => {
                mathChallengeDiv.classList.add('hidden');
                movementControlsDiv.classList.remove('hidden');
                setDialogue(dialogueMessages.move("å‰æ–¹")); // æç¤ºå¯ä»¥ç¹¼çºŒç§»å‹•
            }, 1500);
        } else { // è¸©åˆ°é™·é˜±
            currentHP--;
            setDialogue(dialogueMessages.hitTrap);
            updateStatus();
            // è‡ªå‹•å›åˆ°ç§»å‹•æ§åˆ¶
            setTimeout(() => {
                mathChallengeDiv.classList.add('hidden');
                movementControlsDiv.classList.remove('hidden');
                setDialogue(dialogueMessages.move("å‰æ–¹")); // æç¤ºå¯ä»¥ç¹¼çºŒç§»å‹•
            }, 1500);
        }
    }

    function startGame() {
        currentHP = 3;
        currentLevel = 1;
        currentScore = 0;
        gameOverScreen.style.display = 'none'; // éš±è—çµæŸç•«é¢
        mathChallengeDiv.classList.add('hidden'); // éš±è—æ•¸å­¸é¡Œ
        movementControlsDiv.classList.remove('hidden'); // é¡¯ç¤ºç§»å‹•æŒ‰éˆ•
        setDialogue(dialogueMessages.start);
        updateStatus();
        document.getElementById('map-display').innerText = "ğŸ¶"; // èµ·å§‹åœ°åœ–é¡¯ç¤º
    }

    function endGame() {
        document.getElementById('final-score').innerText = currentScore;
        gameOverScreen.style.display = 'flex';
        mathChallengeDiv.classList.add('hidden');
        movementControlsDiv.classList.add('hidden');
        setDialogue(dialogueMessages.gameOver);
    }

    // åˆå§‹åŒ–éŠæˆ²
    startGame();
</script>

</body>
</html>
